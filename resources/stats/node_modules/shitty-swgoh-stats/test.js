const fetchPlayer = ( token, path ) => {
    return new Promise(( resolve, reject ) => {
        const hostname = `swgoh.shittybots.me`
        const headers = { shittybot:token }
        const https = require('https')
        const results = ( response ) => {
            let data = ''
            response.on('data', (chunk) => data += chunk)
            response.on('end', () => resolve(JSON.parse(data)))
        }
        https
            .get({ hostname, port: 443, path, method: 'GET', headers }, results)
            .on("error", reject)
    })
}


const Stats = require(`.`)
const stats = new Stats()
const sbtoken = process.env.TOKEN

stats.update(sbtoken)
    .then(gamedata => fetchPlayer(sbtoken, '/api/player/282392964'))
    .then(player => {

        //Single player
        console.log('\nStats by single player\n')
        console.log( stats.calcPlayerStats(player) )


        //Array of players
        console.log('\nStats by array of players\n')
        console.log( stats.calcPlayerStats([player]) )

        //Roster unit list
        console.log('\nStats by rosterUnitList\n')
        console.log( stats.calcRosterStats(player.rosterUnitList) )

        //Original player modified
        console.log('\nOriginal player modified\n')
        console.log( player )

    })
    .catch(console.error)
